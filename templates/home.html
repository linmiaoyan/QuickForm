{% extends 'base.html' %}

{% block title %}{{ translate('nav.home') }} - QuickForm{% endblock %}

{% block content %}
<style>
/* Hero区域 - 参考 Cursor 设计：白色背景，深色文字，模糊产品界面背景 */
.hero-section {
    background: #ffffff;
    color: #111827;
    padding: 6rem 2rem 8rem;
    margin: -1.5rem -15px 0 -15px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('{{ url_for("static", filename="images/dashboard-preview.png") }}') center/cover no-repeat;
    opacity: 0.03;
    filter: blur(40px);
    z-index: 0;
}

.hero-content {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
}

.hero-title {
    font-size: 3.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    line-height: 1.1;
    color: #111827;
    letter-spacing: -0.02em;
}

.hero-subtitle {
    font-size: 1.375rem;
    font-weight: 400;
    margin-bottom: 2.5rem;
    color: #6b7280;
    line-height: 1.6;
}

.hero-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.hero-buttons .btn {
    padding: 0.875rem 2rem;
    font-size: 1.125rem;
    border-radius: 8px;
    font-weight: 500;
}

/* 产品界面展示区域 - 模拟界面卡片 */
.product-showcase {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    margin: -4rem auto 4rem;
    max-width: 1200px;
    position: relative;
    z-index: 2;
}

.product-showcase-header {
    background: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.product-showcase-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #e5e7eb;
}

.product-showcase-dot:nth-child(1) { background: #ef4444; }
.product-showcase-dot:nth-child(2) { background: #f59e0b; }
.product-showcase-dot:nth-child(3) { background: #10b981; }

.product-showcase-content {
    padding: 2rem;
    background: #ffffff;
}

/* 社会认同区域 */
.social-proof {
    text-align: center;
    padding: 3rem 2rem;
    background: #ffffff;
}

.social-proof-text {
    font-size: 1.125rem;
    color: #6b7280;
    margin-bottom: 2rem;
    font-weight: 400;
}

.social-proof-logos {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 3rem;
    opacity: 0.6;
    filter: grayscale(100%);
}

.social-proof-logo {
    height: 40px;
    width: auto;
    max-width: 150px;
    object-fit: contain;
    transition: opacity 0.3s ease;
}

.social-proof-logo:hover {
    opacity: 1;
    filter: grayscale(0%);
}

/* 功能展示区域 */
.feature-showcase {
    padding: 4rem 2rem;
    background: #ffffff;
}

.feature-showcase-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    max-width: 1200px;
    margin: 0 auto;
    align-items: center;
}

.feature-showcase-content h2 {
    font-size: 2.5rem;
    font-weight: 700;
    color: #111827;
    margin-bottom: 1.5rem;
    line-height: 1.2;
    letter-spacing: -0.02em;
}

.feature-showcase-content p {
    font-size: 1.125rem;
    color: #6b7280;
    line-height: 1.7;
    margin-bottom: 2rem;
}

.feature-showcase-link {
    color: #2563eb;
    text-decoration: none;
    font-weight: 500;
    font-size: 1.125rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: color 0.2s;
}

.feature-showcase-link:hover {
    color: #1d4ed8;
}

.feature-showcase-visual {
    background: #f9fafb;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
}

@media (max-width: 768px) {
    .hero-section {
        padding: 4rem 1.5rem 6rem;
    }
    .hero-title {
        font-size: 2.25rem;
    }
    .hero-subtitle {
        font-size: 1.125rem;
    }
    .product-showcase {
        margin: -3rem auto 3rem;
        border-radius: 8px;
    }
    .feature-showcase-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    .social-proof-logos {
        gap: 2rem;
    }
}
</style>

<!-- Hero区域 - 参考 Cursor 设计 -->
<div class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">
            {{ translate('home.hero_title') if translate('home.hero_title') != 'home.hero_title' else 'QuickForm' }}<br>
            {{ translate('home.hero_title_sub') if translate('home.hero_title_sub') != 'home.hero_title_sub' else '基于Web的智能表单管理服务' }}
        </h1>
        <p class="hero-subtitle">{{ translate('home.hero_subtitle') if translate('home.hero_subtitle') != 'home.hero_subtitle' else '快速构建、智能管理表单数据，是优化 AI 表单设计的最佳方式' }}</p>
        <div class="hero-buttons">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('quickform.dashboard') }}" class="btn btn-primary btn-lg" style="background-color: #2563eb; color: white; border: none;">{{ translate('home.enter_dashboard') }}</a>
            {% else %}
                <a href="{{ url_for('quickform.register') }}" class="btn btn-primary btn-lg" style="background-color: #2563eb; color: white; border: none;">{{ translate('home.register_now') if translate('home.register_now') != 'home.register_now' else '立即注册' }}</a>
                <a href="{{ url_for('quickform.login') }}" class="btn btn-outline-primary btn-lg" style="border: 2px solid #2563eb; color: #2563eb; background: transparent;">{{ translate('home.login') if translate('home.login') != 'home.login' else '登录' }}</a>
            {% endif %}
        </div>
    </div>
</div>

<style>
.video-carousel-container {
    position: relative;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
}

.video-carousel-wrapper {
    position: relative;
    border-radius: 10px;
    overflow: hidden;
    background: #000;
}

.video-carousel-wrapper video {
    width: 100%;
    max-height: 600px;
    display: block;
    object-fit: contain;
}

.video-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(37, 99, 235, 0.8);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    font-size: 1.5rem;
    font-weight: 600;
}

.video-carousel-nav:hover {
    background: rgba(37, 99, 235, 1);
    transform: translateY(-50%) scale(1.1);
}

.video-carousel-nav.prev {
    left: 15px;
}

.video-carousel-nav.next {
    right: 15px;
}

.video-carousel-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.video-carousel-nav:disabled:hover {
    transform: translateY(-50%);
    background: rgba(37, 99, 235, 0.8);
}

.video-indicator {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
}

.video-indicator-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
}

.video-indicator-dot.active {
    background: #2563eb;
    width: 24px;
    border-radius: 5px;
}

@media (max-width: 768px) {
    .video-carousel-nav {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
    
    .video-carousel-nav.prev {
        left: 10px;
    }
    
    .video-carousel-nav.next {
        right: 10px;
    }
}
</style>

<!-- 产品界面展示区域 - 参考 Cursor 设计 -->
<div class="container-fluid px-3 px-md-4">
    <div class="product-showcase">
        <div class="product-showcase-header">
            <div class="product-showcase-dot"></div>
            <div class="product-showcase-dot"></div>
            <div class="product-showcase-dot"></div>
        </div>
        <div class="product-showcase-content">
            <!-- 视频播放区域 - 轮播 -->
            {% if video_files and video_files|length > 0 %}
            <div class="video-carousel-container">
                <div class="video-carousel-wrapper">
                    <video 
                        id="main-video-player"
                        class="w-100" 
                        controls 
                        autoplay 
                        muted 
                        style="max-height: 600px; background: #000; display: block; border-radius: 8px;"
                        poster="">
                        <source id="video-source" src="{{ url_for('static', filename='videos/' + video_files[0]) }}" type="video/mp4">
                        {{ translate('common.browser_not_support_video') if translate('common.browser_not_support_video') != 'common.browser_not_support_video' else '您的浏览器不支持视频播放。' }}
                    </video>
                    
                    {% if video_files|length > 1 %}
                    <button class="video-carousel-nav prev" onclick="changeVideo(-1)" id="prev-btn">
                        ‹
                    </button>
                    <button class="video-carousel-nav next" onclick="changeVideo(1)" id="next-btn">
                        ›
                    </button>
                    
                    <div class="video-indicator">
                        {% for video_file in video_files %}
                        <div class="video-indicator-dot {% if loop.index0 == 0 %}active{% endif %}" 
                             onclick="goToVideo({{ loop.index0 }})" 
                             data-video-index="{{ loop.index0 }}"></div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="video-carousel-container">
                <div class="video-carousel-wrapper">
                    <video 
                        class="w-100" 
                        controls 
                        autoplay 
                        muted 
                        loop
                        style="max-height: 600px; background: #000; display: block; border-radius: 8px;">
                        <source src="{{ url_for('static', filename='videos/index.mp4') }}" type="video/mp4">
                        {{ translate('common.browser_not_support_video') if translate('common.browser_not_support_video') != 'common.browser_not_support_video' else '您的浏览器不支持视频播放。' }}
                    </video>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- 社会认同区域 - 参考 Cursor 设计 -->
    <div class="social-proof">
        <p class="social-proof-text">每天被数千名专业用户信赖使用</p>
        <div class="social-proof-logos">
            {% if partner_logos and partner_logos|length > 0 %}
                {% for logo_file in partner_logos %}
                <img src="{{ url_for('static', filename='partners/' + logo_file) }}" alt="合作伙伴" class="social-proof-logo">
                {% endfor %}
            {% else %}
                <!-- 如果没有logo，显示占位符 -->
                <div style="width: 120px; height: 40px; background: #e5e7eb; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-size: 0.875rem;">合作伙伴</div>
            {% endif %}
        </div>
    </div>

    <!-- 功能展示区域 - 参考 Cursor 设计 -->
    <div class="feature-showcase">
        <div class="feature-showcase-grid">
            <div class="feature-showcase-content">
                <h2>AI 将想法转化为表单</h2>
                <p>人机协作的智能表单系统，效率比传统方式高出数个数量级。通过 AI 助手，您可以快速创建、优化和管理表单，让数据收集变得简单高效。</p>
            </div>
            <div class="feature-showcase-visual">
                <!-- 表单创建界面预览 -->
                <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 0; min-height: 300px; overflow: hidden;">
                    <iframe 
                        src="{{ url_for('static', filename='previews/form-preview.html') }}" 
                        style="width: 100%; height: 400px; border: none; display: block;"
                        title="表单创建界面预览">
                    </iframe>
                </div>
            </div>
        </div>
    </div>

<!-- 快速开始和关于QuickForm区域 - 使用feature-showcase样式 -->
<div class="feature-showcase">
    <!-- 快速开始 -->
    <div class="feature-showcase-grid" style="margin-bottom: 4rem;">
        <div class="feature-showcase-content">
            <h2>{{ translate('home.quick_start') if translate('home.quick_start') != 'home.quick_start' else '快速开始' }}</h2>
            <p style="margin-bottom: 1rem;">{{ translate('home.step1') if translate('home.step1') != 'home.step1' else '1. 注册账号并登录系统' }}</p>
            <p style="margin-bottom: 1rem;">{{ translate('home.step2') if translate('home.step2') != 'home.step2' else '2. 创建数据收集任务' }}</p>
            <p style="margin-bottom: 1rem;">{{ translate('home.step3') if translate('home.step3') != 'home.step3' else '3. 获取数据提交URL并嵌入表单' }}</p>
            <p style="margin-bottom: 2rem;">{{ translate('home.step4') if translate('home.step4') != 'home.step4' else '4. 查看和分析收集的数据' }}</p>
            <a href="{{ url_for('quickform.register') if not current_user.is_authenticated else url_for('quickform.create_task') }}" class="feature-showcase-link">
                立即开始 →
            </a>
        </div>
        <div class="feature-showcase-visual">
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 2rem; min-height: 300px; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                <div style="text-align: center;">
                    <i class="bi bi-rocket-takeoff" style="font-size: 3rem; margin-bottom: 1rem; display: block; color: #2563eb;"></i>
                    <p>快速开始指南</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 关于QuickForm -->
    <div class="feature-showcase-grid">
        <div class="feature-showcase-visual">
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 2rem; min-height: 300px; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                <div style="text-align: center;">
                    <i class="bi bi-info-circle" style="font-size: 3rem; margin-bottom: 1rem; display: block; color: #2563eb;"></i>
                    <p>关于QuickForm</p>
                </div>
            </div>
        </div>
        <div class="feature-showcase-content">
            <h2>{{ translate('home.about') if translate('home.about') != 'home.about' else '关于QuickForm' }}</h2>
            <p style="margin-bottom: 1.5rem; color: #6b7280; line-height: 1.7;">
                <strong style="color: #2563eb;">QuickForm</strong>是一款基于Web的智能表单管理服务，由温州科技高中AI科创中心团队与温州大学联合开发。其主要功能是简化数据收集、分析和报告生成的全流程。
            </p>
            <p style="margin-bottom: 2rem; color: #6b7280; line-height: 1.7;">
                系统支持表单管理、数据收集、智能分析、报告生成和AI集成等功能，能够自动识别数据趋势、生成可视化图表和详细报告，辅助教师优化教学策略。
            </p>
        </div>
    </div>
</div>

{% if video_files and video_files|length > 1 %}
<script>
const videoFiles = {{ video_files|tojson }};
let currentVideoIndex = 0;
const videoPlayer = document.getElementById('main-video-player');
const videoSource = document.getElementById('video-source');

function updateVideo(index) {
    if (index < 0 || index >= videoFiles.length) return;
    
    currentVideoIndex = index;
    // 构建视频URL
    const baseUrl = "{{ url_for('static', filename='videos/') }}";
    const videoUrl = baseUrl + videoFiles[index];
    
    // 更新视频源
    videoSource.src = videoUrl;
    
    // 根据文件扩展名设置type
    const ext = videoFiles[index].toLowerCase().split('.').pop();
    let mimeType = 'video/mp4';
    if (ext === 'webm') mimeType = 'video/webm';
    else if (ext === 'ogg') mimeType = 'video/ogg';
    else if (ext === 'mov') mimeType = 'video/quicktime';
    
    videoSource.type = mimeType;
    videoPlayer.load();
    
    // 更新指示器
    document.querySelectorAll('.video-indicator-dot').forEach((dot, i) => {
        if (i === index) {
            dot.classList.add('active');
        } else {
            dot.classList.remove('active');
        }
    });
    
    // 更新按钮状态
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    if (prevBtn) prevBtn.disabled = index === 0;
    if (nextBtn) nextBtn.disabled = index === videoFiles.length - 1;
    
    // 自动播放
    videoPlayer.play().catch(e => {
        console.log('自动播放被阻止:', e);
    });
}

function changeVideo(direction) {
    const newIndex = currentVideoIndex + direction;
    if (newIndex >= 0 && newIndex < videoFiles.length) {
        updateVideo(newIndex);
    }
}

function goToVideo(index) {
    updateVideo(index);
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    if (videoFiles && videoFiles.length > 0) {
        updateVideo(0);
        
        // 键盘导航支持（仅在视频播放器区域）
        videoPlayer.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                changeVideo(-1);
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                changeVideo(1);
            }
        });
        
        // 视频播放结束时自动切换到下一个
        videoPlayer.addEventListener('ended', function() {
            if (currentVideoIndex < videoFiles.length - 1) {
                changeVideo(1);
            } else {
                // 如果是最后一个视频，循环到第一个
                updateVideo(0);
            }
        });
    }
});
</script>
{% endif %}
{% endblock %}
